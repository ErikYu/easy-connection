!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).EasyConnection={})}(this,function(t){"use strict";function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}function c(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function x(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(o,!0).forEach(function(t){c(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var o=[],n=!0,i=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(o.push(s.value),!e||o.length!==e);n=!0);}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return o}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var u,s;function p(t,e){var o=e.onmouseenter,n=e.onmouseleave,i=e.onmousedown,r=document.createElementNS("http://www.w3.org/2000/svg","polyline");return r.setAttributeNS(null,"fill","none"),r.setAttributeNS(null,"stroke","".concat(t.color)),r.setAttributeNS(null,"stroke-width","".concat(t.strokeWidth)),r.onmouseenter=o,r.onmouseleave=n,r.onmousedown=i,r}function f(t){return+t.slice(0,t.length-2)}function d(t){return"".concat(t,"px")}function g(t,e){var o=Array.isArray(e)?e:[e],n=!0,i=!1,r=void 0;try{for(var s,a=o[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;t.classList.contains(l)||t.classList.add(l)}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}function m(t,e){var o=Array.isArray(e)?e:[e],n=Array.isArray(t)?t:[t],i=!0,r=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var c=a.value,h=!0,p=!1,f=void 0;try{for(var u,d=o[Symbol.iterator]();!(h=(u=d.next()).done);h=!0){var g=u.value;c.classList.remove(g)}}catch(t){p=!0,f=t}finally{try{h||null==d.return||d.return()}finally{if(p)throw f}}}}catch(t){r=!0,s=t}finally{try{i||null==l.return||l.return()}finally{if(r)throw s}}}function v(e,o){Object.keys(o).forEach(function(t){e.style[t]=o[t]})}(s=u=u||{})[s.horizontalLeftTop=0]="horizontalLeftTop",s[s.horizontalLeftBottom=1]="horizontalLeftBottom",s[s.horizontalRightTop=2]="horizontalRightTop",s[s.horizontalRightBottom=3]="horizontalRightBottom",s[s.verticalLeftTop=4]="verticalLeftTop",s[s.verticalLeftBottom=5]="verticalLeftBottom",s[s.verticalRightTop=6]="verticalRightTop",s[s.verticalRightBottom=7]="verticalRightBottom";var y="cnt";function P(t,e){return t<=0&&e<=0?u.horizontalLeftTop:t<=0&&0<e?u.horizontalLeftBottom:0<t&&e<=0?u.horizontalRightTop:u.horizontalRightBottom}function w(t,e){return t<=0&&e<=0?u.verticalLeftTop:t<=0&&0<e?u.verticalLeftBottom:0<t&&e<=0?u.verticalRightTop:u.verticalRightBottom}function b(t){return{offsetLeft:t.offsetLeft+t.offsetParent.offsetLeft,offsetTop:t.offsetTop+t.offsetParent.offsetTop}}var C=function(){function s(t,e,o,n){var i=this;S(this,s),this.isMoving=!1,this.onmouseenter=function(t){var e=t.target,o=i.options.hoverColor||i.options.color;e.style.stroke=o,i.svgElement.getElementById("markerEndArrow").getElementsByTagName("path")[0].style.fill=o},this.onmouseleave=function(t){t.target.style.stroke=i.options.color,i.svgElement.getElementById("markerEndArrow").getElementsByTagName("path")[0].style.fill=i.options.color},this.onmousedown=function(t){if(i.checkIfMouseEventOnArrow(t)){i.isMoving=!0;var e=t.pageX-i.playground.offsetLeft,o=t.pageY-i.playground.offsetTop;i.helperPointer=document.createElement("div"),v(i.helperPointer,{width:"0px",height:"0px",position:"absolute",left:"".concat(e-3,"px"),top:"".concat(o-3,"px")}),i.playground.appendChild(i.helperPointer),i.endElement=i.helperPointer,i.endPointer=void 0,document.onmousemove=function(t){if(i.isMoving){i.helperPointer.style.left="".concat(t.pageX-i.playground.offsetLeft-3,"px"),i.helperPointer.style.top="".concat(t.pageY-i.playground.offsetTop-3,"px"),i.renderLine();var e=document.elementsFromPoint(t.clientX,t.clientY).filter(function(t){return t.classList.contains("cnt-element")}),o=i.playground.getElementsByClassName("".concat(y,"-element"));0<e.length?(g(e[0],"".concat(y,"-will")),m(Array.from(o).filter(function(t){return t!==e[0]}),"".concat(y,"-will"))):m(Array.from(o),"".concat(y,"-will"))}},document.onmouseup=function(t){i.isMoving=!1;var e=document.elementsFromPoint(t.clientX,t.clientY).filter(function(t){return t.classList.contains("cnt-element")});0<e.length?(i.endElement=e[0],i.endPointer=void 0,i.renderLine(),m(e[0],"".concat(y,"-will"))):i.dispose(),i.helperPointer&&(i.playground.removeChild(i.helperPointer),i.helperPointer=void 0)}}},this.options=n,this.startElement=e,this.endElement=o,g(e,"".concat(y,"-element")),g(o,"".concat(y,"-element")),this.playground=t;var r=this.createConnectPoint(this.startElement,this.endElement);this.startPointer=r.start,this.endPointer=r.end,g(this.startPointer,"".concat(y,"-pointer")),g(this.endPointer,"".concat(y,"-pointer")),this.svgElement=this.createSvgArea(),this.drawPath(),this.playground.appendChild(this.svgElement)}return e(s,[{key:"renderLine",value:function(){var t=this.createConnectPoint(this.startElement,this.endElement);this.startPointer=t.start,this.endPointer=t.end,g(this.startPointer,"".concat(y,"-pointer")),g(this.endPointer,"".concat(y,"-pointer")),this.playground.removeChild(this.svgElement),this.svgElement=this.createSvgArea(),this.drawPath(),this.playground.appendChild(this.svgElement)}},{key:"dispose",value:function(){this.startElement&&this.startPointer&&this.startElement.removeChild(this.startPointer),this.endElement&&this.endPointer&&this.endElement.removeChild(this.endPointer),this.playground.removeChild(this.svgElement)}},{key:"createConnectPoint",value:function(t,e){this.startPointer&&t.removeChild(this.startPointer),this.endPointer&&e.removeChild(this.endPointer);var o=document.createElement("div"),n=document.createElement("div");o.style.position="absolute",n.style.position="absolute",o.style.backgroundColor="#000000",n.style.backgroundColor="#000000",o.style.width="".concat(this.options.pointerSize,"px"),n.style.width="".concat(this.options.pointerSize,"px"),o.style.height="".concat(this.options.pointerSize,"px"),n.style.height="".concat(this.options.pointerSize,"px");var i=t.offsetLeft-e.offsetLeft,r=t.offsetTop-e.offsetTop;this.startPosition=function(t,e,o){switch(o){case"auto":return Math.abs(t)>=Math.abs(e)?P(t,e):w(t,e);case"horizontal":return P(t,e);case"vertical":default:return w(t,e)}}(i,r,this.options.pointerPosition);var s=function(t,e,o,n){switch(t){case u.horizontalLeftTop:case u.horizontalLeftBottom:return{startLeft:"".concat(e.getBoundingClientRect().width,"px"),startTop:"".concat(e.getBoundingClientRect().height/2-n/2,"px"),endLeft:"".concat(-n,"px"),entTop:"".concat(o.getBoundingClientRect().height/2-n/2,"px")};case u.horizontalRightBottom:case u.horizontalRightTop:return{startLeft:"".concat(-n,"px"),startTop:"".concat(e.getBoundingClientRect().height/2-n/2,"px"),endLeft:"".concat(o.getBoundingClientRect().width,"px"),entTop:"".concat(o.getBoundingClientRect().height/2-n/2,"px")};case u.verticalLeftTop:case u.verticalRightTop:return{startLeft:"".concat(e.getBoundingClientRect().width/2-n/2,"px"),startTop:"".concat(e.getBoundingClientRect().height,"px"),endLeft:"".concat(o.getBoundingClientRect().width/2-n/2,"px"),entTop:"".concat(-n,"px")};case u.verticalLeftBottom:case u.verticalRightBottom:return{startLeft:"".concat(e.getBoundingClientRect().width/2-n/2,"px"),startTop:"-".concat(n,"px"),endLeft:"".concat(o.getBoundingClientRect().width/2-n/2,"px"),entTop:"".concat(o.getBoundingClientRect().height,"px")}}}(this.startPosition,t,e,this.options.pointerSize),a=s.startLeft,l=s.startTop,c=s.endLeft,h=s.entTop;return o.style.left=a,o.style.top=l,n.style.left=c,n.style.top=h,t.appendChild(o),e.appendChild(n),{start:o,end:n}}},{key:"createSvgArea",value:function(){var t=function(t,e,o,n){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.innerHTML='\n    <defs>\n      <marker id="markerEndArrow" viewBox="0 0 30 30" refX="9" refY="3"  markerUnits="strokeWidth" markerWidth="30" markerHeight="30" orient="auto">\n        <path style="fill:'.concat(n.color,';opacity:1" d="M0,0 0,6 9,3z" />\n      </marker>\n    </defs>'),i.style.position="absolute",i.style.zIndex="999",i.style.overflow="visible";var r=b(e),s=r.offsetLeft,a=r.offsetTop,l=b(o),c=l.offsetLeft,h=l.offsetTop;switch(t){case u.horizontalLeftTop:case u.verticalLeftTop:i.style.left="".concat(s,"px"),i.style.top="".concat(a,"px");break;case u.horizontalRightTop:case u.verticalRightTop:i.style.left="".concat(c,"px"),i.style.top="".concat(a,"px");break;case u.horizontalLeftBottom:case u.verticalLeftBottom:i.style.left="".concat(s,"px"),i.style.top="".concat(h,"px");break;case u.horizontalRightBottom:case u.verticalRightBottom:i.style.left="".concat(c,"px"),i.style.top="".concat(h,"px")}var p=Math.abs(s-c)+n.pointerSize,f=Math.abs(a-h)+n.pointerSize;return i.setAttribute("width","".concat(p,"px")),i.setAttribute("height","".concat(f,"px")),i}(this.startPosition,this.startPointer,this.endPointer,this.options),e=t.width.baseVal.valueInSpecifiedUnits,o=t.height.baseVal.valueInSpecifiedUnits;return this.svgParameters={height:o,width:e,leftTop:[this.options.pointerSize/2,this.options.pointerSize/2],leftBottom:[this.options.pointerSize/2,o-this.options.pointerSize/2],rightTop:[e-this.options.pointerSize/2,this.options.pointerSize/2],rightBottom:[e-this.options.pointerSize/2,o-this.options.pointerSize/2]},t}},{key:"getTotalOffset",value:function(t){return{offsetLeft:t.offsetLeft+t.offsetParent.offsetLeft,offsetTop:t.offsetTop+t.offsetParent.offsetTop}}},{key:"checkIfMouseEventOnArrow",value:function(t){function e(t,e){return Math.abs(t-e)<50}var o,n=t.offsetX,i=t.offsetY,r=(c(o={},u.horizontalLeftTop,"rightBottom"),c(o,u.verticalLeftTop,"rightBottom"),o),s=h(this.svgParameters[r[this.startPosition]],2),a=s[0],l=s[1];return e(n,a)&&e(i,l)}}]),s}(),T=function(){function r(t,e,o,n){var i;return S(this,r),(i=l(this,a(r).call(this,t,e,o,n))).isModifyingConnector=!1,i}return o(r,C),e(r,[{key:"drawPath",value:function(){var t,e;switch(this.startPosition){case u.verticalLeftTop:case u.horizontalLeftTop:t=this.svgParameters.leftTop,e=this.svgParameters.rightBottom;break;case u.verticalLeftBottom:case u.horizontalLeftBottom:t=this.svgParameters.leftBottom,e=this.svgParameters.rightTop;break;case u.verticalRightTop:case u.horizontalRightTop:t=this.svgParameters.rightTop,e=this.svgParameters.leftBottom;break;case u.verticalRightBottom:case u.horizontalRightBottom:t=this.svgParameters.rightBottom,e=this.svgParameters.leftTop}var o=p(this.options,{onmouseenter:this.onmouseenter,onmouseleave:this.onmouseleave,onmousedown:this.onmousedown});!function(t,e,o){t.setAttributeNS(null,"points","".concat(e.toString()," ").concat(o.toString()))}(o,t,e),o.style.markerEnd="url(#markerEndArrow)",this.svgElement.appendChild(o)}}]),r}(),L=function(){function o(t,e){S(this,o),this.isDragging=!1,this.elem=t,this.dragOptions=e||{type:"straight"},this.makeItDraggable(),this.elemStartCoordinate={xPos:f(getComputedStyle(this.elem).left),yPos:f(getComputedStyle(this.elem).top)}}return e(o,[{key:"makeItDraggable",value:function(){var n=this;this.elem.style.position="absolute",this.elem.onmousedown=function(t){n.startCoordinate={xPos:t.clientX,yPos:t.clientY},n.isDragging=!0,document.onmousemove=function(t){if(n.isDragging){var e=t.clientX-n.startCoordinate.xPos,o=t.clientY-n.startCoordinate.yPos;n.elem.style.left=d(n.elemStartCoordinate.xPos+e),n.elem.style.top=d(n.elemStartCoordinate.yPos+o),"function"==typeof n.dragOptions.onDragging&&n.dragOptions.onDragging()}},document.onmouseup=function(){n.isDragging=!1,n.startCoordinate=void 0,n.elemStartCoordinate={xPos:f(getComputedStyle(n.elem).left),yPos:f(getComputedStyle(n.elem).top)},document.onmousemove=function(){}}}}}]),o}(),z=function(){function i(t,e,o,n){return S(this,i),l(this,a(i).call(this,t,e,o,n))}return o(i,C),e(i,[{key:"drawPath",value:function(){var t,e,o,n,i=this.svgElement.width.baseVal.valueInSpecifiedUnits,r=this.svgElement.height.baseVal.valueInSpecifiedUnits;switch(this.startPosition){case u.verticalLeftTop:t=this.svgParameters.leftTop,e=[this.options.pointerSize/2,r/2],o=[i-this.options.pointerSize/2,r/2],n=this.svgParameters.rightBottom;break;case u.horizontalLeftTop:t=this.svgParameters.leftTop,e=[i/2,this.options.pointerSize/2],o=[i/2,r-this.options.pointerSize/2],n=this.svgParameters.rightBottom;break;case u.verticalRightTop:t=this.svgParameters.rightTop,e=[i-this.options.pointerSize/2,r/2],o=[this.options.pointerSize/2,r/2],n=this.svgParameters.leftBottom;break;case u.horizontalRightTop:t=this.svgParameters.rightTop,e=[i/2,this.options.pointerSize/2],o=[i/2,r-this.options.pointerSize/2],n=this.svgParameters.leftBottom;break;case u.verticalLeftBottom:t=this.svgParameters.leftBottom,e=[this.options.pointerSize/2,r/2],o=[i-this.options.pointerSize/2,r/2],n=this.svgParameters.rightTop;break;case u.horizontalLeftBottom:t=this.svgParameters.leftBottom,e=[i/2,r-this.options.pointerSize/2],o=[i/2,this.options.pointerSize/2],n=this.svgParameters.rightTop;break;case u.verticalRightBottom:t=this.svgParameters.rightBottom,e=[i-this.options.pointerSize/2,r/2],o=[this.options.pointerSize/2,r/2],n=this.svgParameters.leftTop;break;case u.horizontalRightBottom:t=this.svgParameters.rightBottom,e=[i/2,r-this.options.pointerSize/2],o=[i/2,this.options.pointerSize/2],n=this.svgParameters.leftTop}var s=p(this.options,{onmouseenter:this.onmouseenter,onmouseleave:this.onmouseleave,onmousedown:this.onmousedown});!function(t,e,o,n,i){t.setAttributeNS(null,"points","".concat(e.toString()," ").concat(o.toString()," ").concat(n.toString()," ").concat(i.toString()))}(s,t,e,o,n),s.style.markerEnd="url(#markerEndArrow)",this.svgElement.appendChild(s)}}]),i}(),B={undefined:T,straight:T,flowchart:z},E=function(){function s(t,e,o,n){var i,r=n.onCreatingLine;return S(this,s),(i=l(this,a(s).call(this,e,o))).isCreatingNewConnector=!1,v(i.nativeElement=e,{zIndex:"2"}),i.playground=t,i.onCreatingLine=r,g(e,"".concat(y,"-element")),i.createAnchor(),i}return o(s,L),e(s,[{key:"createAnchor",value:function(){var i=this,t=document.createElement("div");t.classList.add("".concat(y,"-anchor")),v(t,{width:"10px",height:"10px",backgroundColor:"red",position:"absolute",left:"15px",top:"15px"}),t.onmousedown=function(t){t.stopPropagation(),i.isCreatingNewConnector=!0;var e=t.pageX-i.playground.offsetLeft,o=t.pageY-i.playground.offsetTop;i.helperPointer=document.createElement("div"),v(i.helperPointer,{width:"0px",height:"0px",position:"absolute",left:"".concat(e-3,"px"),top:"".concat(o-3,"px")}),i.playground.appendChild(i.helperPointer);var n=new B[i.dragOptions.type](i.playground,i.elem,i.helperPointer,i.dragOptions);document.onmousemove=function(t){if(i.isCreatingNewConnector){i.helperPointer.style.left="".concat(t.pageX-i.playground.offsetLeft-3,"px"),i.helperPointer.style.top="".concat(t.pageY-i.playground.offsetTop-3,"px"),n&&n.renderLine();var e=document.elementsFromPoint(t.clientX,t.clientY).filter(function(t){return t.classList.contains("cnt-element")}),o=i.playground.getElementsByClassName("".concat(y,"-element"));0<e.length?(g(e[0],"".concat(y,"-will")),m(Array.from(o).filter(function(t){return t!==e[0]}),"".concat(y,"-will"))):m(Array.from(o),"".concat(y,"-will"))}},document.onmouseup=function(t){i.isCreatingNewConnector=!1;var e=document.elementsFromPoint(t.clientX,t.clientY).filter(function(t){return t.classList.contains("cnt-element")});n&&(n.dispose(),n=null),0<e.length&&(i.onCreatingLine(e[0]),m(e[0],"".concat(y,"-will"))),i.helperPointer&&(i.playground.removeChild(i.helperPointer),i.helperPointer=void 0)}},this.elem.appendChild(t)}}]),s}(),k={undefined:T,straight:T,flowchart:z},R=function(){function L(t){var o=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{type:"straight"};S(this,L),this.connectableElements=[],this.connections=[],this.elementConnectionsMap={},this.playground=t,this.options=x({color:"#cccccc",hoverColor:"red",pointerPosition:"auto",pointerSize:4,strokeWidth:1,arrowSize:15},i);var r=!0,s=!1,a=void 0;try{for(var l,c=e[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var h=l.value;this.elementConnectionsMap[h.id]=[]}}catch(t){s=!0,a=t}finally{try{r||null==c.return||c.return()}finally{if(s)throw a}}var p=!0,f=!1,u=void 0;try{for(var d,g=n[Symbol.iterator]();!(p=(d=g.next()).done);p=!0){var m=d.value,v=new k[i.type](t,m.start,m.end,this.options);this.elementConnectionsMap[m.start.id].push(v),this.elementConnectionsMap[m.end.id].push(v),this.connections.push(v)}}catch(t){f=!0,u=t}finally{try{p||null==g.return||g.return()}finally{if(f)throw u}}var y=!0,P=!1,w=void 0;try{for(var b,C=function(){var e=b.value;o.connectableElements.push(new E(t,e,x({},o.options,{onDragging:function(){o.elementConnectionsMap[e.id].forEach(function(t){return t.renderLine()})}}),{onCreatingLine:function(t){o.addConnection({start:e,end:t})}}))},T=e[Symbol.iterator]();!(y=(b=T.next()).done);y=!0)C()}catch(t){P=!0,w=t}finally{try{y||null==T.return||T.return()}finally{if(P)throw w}}}return e(L,[{key:"addElement",value:function(e){var o=this;this.elementConnectionsMap[e.id]=[],this.playground.appendChild(e),this.connectableElements.push(new E(this.playground,e,x({},this.options,{onDragging:function(){o.elementConnectionsMap[e.id].forEach(function(t){return t.renderLine()})}}),{onCreatingLine:function(t){o.addConnection({start:e,end:t})}}))}},{key:"addConnection",value:function(t){var e=new k[this.options.type](this.playground,t.start,t.end,this.options);this.elementConnectionsMap[t.start.id].push(e),this.elementConnectionsMap[t.end.id].push(e),this.connections.push(e)}}]),L}();t.EasyConnection=R,t.ConnectorBase=T,t.ConnectorFlowchart=z,t.Draggable=L,t.Connectable=E,Object.defineProperty(t,"__esModule",{value:!0})});
