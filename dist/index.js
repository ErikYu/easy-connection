!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).EasyConnection={})}(this,function(t){"use strict";function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}function o(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function B(i){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(r,!0).forEach(function(t){var e,o,n;e=i,n=r[o=t],o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):o(r).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(r,t))})}return i}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var p,s;(s=p=p||{})[s.horizontalLeftTop=0]="horizontalLeftTop",s[s.horizontalLeftBottom=1]="horizontalLeftBottom",s[s.horizontalRightTop=2]="horizontalRightTop",s[s.horizontalRightBottom=3]="horizontalRightBottom",s[s.verticalLeftTop=4]="verticalLeftTop",s[s.verticalLeftBottom=5]="verticalLeftBottom",s[s.verticalRightTop=6]="verticalRightTop",s[s.verticalRightBottom=7]="verticalRightBottom";var l="cnt";function h(t){var e=document.createElementNS("http://www.w3.org/2000/svg","polyline");return e.setAttributeNS(null,"fill","transparent"),e.setAttributeNS(null,"stroke","".concat(t.color)),e.setAttributeNS(null,"stroke-width","".concat(t.strokeWidth)),e}function f(t){return+t.slice(0,t.length-2)}function u(t){return"".concat(t,"px")}function g(t,e){var o=Array.isArray(e)?e:[e],n=!0,i=!1,r=void 0;try{for(var s,a=o[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var c=s.value;t.classList.contains(c)||t.classList.add(c)}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}var d=function(){function r(t,e,o,n){T(this,r),this.options=B({pointerSize:4,strokeWidth:1,color:"#cccccc",arrowSize:15},n),this.startElement=e,this.endElement=o,g(e,"".concat(l,"-element")),g(o,"".concat(l,"-element")),this.playground=t;var i=this.createConnectPoint(this.startElement,this.endElement);this.startPointer=i.start,this.endPointer=i.end,g(this.startPointer,"".concat(l,"-pointer")),g(this.endPointer,"".concat(l,"-pointer")),this.svgElement=this.createSvgArea(),this.drawEndArrow(),this.drawPath(),this.playground.appendChild(this.svgElement)}return e(r,[{key:"renderLine",value:function(){var t=this.createConnectPoint(this.startElement,this.endElement);this.startPointer=t.start,this.endPointer=t.end,this.playground.removeChild(this.svgElement),this.svgElement=this.createSvgArea(),this.drawEndArrow(),this.drawPath(),this.playground.appendChild(this.svgElement)}},{key:"dispose",value:function(){this.startPointer&&this.startElement.removeChild(this.startPointer),this.endPointer&&this.endElement.removeChild(this.endPointer),this.playground.removeChild(this.svgElement)}}]),e(r,[{key:"createConnectPoint",value:function(t,e){this.startPointer&&t.removeChild(this.startPointer),this.endPointer&&e.removeChild(this.endPointer);var o=document.createElement("div"),n=document.createElement("div");o.style.position="absolute",n.style.position="absolute",o.style.backgroundColor="#000000",n.style.backgroundColor="#000000",o.style.width="".concat(this.options.pointerSize,"px"),n.style.width="".concat(this.options.pointerSize,"px"),o.style.height="".concat(this.options.pointerSize,"px"),n.style.height="".concat(this.options.pointerSize,"px");var i=t.offsetLeft-e.offsetLeft,r=t.offsetTop-e.offsetTop;switch(Math.abs(i)>=Math.abs(r)?this.startPosition=i<=0&&r<=0?p.horizontalLeftTop:i<=0&&0<r?p.horizontalLeftBottom:0<i&&r<=0?p.horizontalRightTop:p.horizontalRightBottom:this.startPosition=i<=0&&r<=0?p.verticalLeftTop:i<=0&&0<r?p.verticalLeftBottom:0<i&&r<=0?p.verticalRightTop:p.verticalRightBottom,this.startPosition){case p.horizontalLeftTop:case p.horizontalLeftBottom:o.position="right",n.position="left",o.style.left="".concat(t.getBoundingClientRect().width,"px"),o.style.top="".concat(t.getBoundingClientRect().height/2-this.options.pointerSize/2,"px"),n.style.left="".concat(-this.options.pointerSize,"px"),n.style.top="".concat(e.getBoundingClientRect().height/2-this.options.pointerSize/2,"px");break;case p.horizontalRightBottom:case p.horizontalRightTop:o.position="left",n.position="right",o.style.left="".concat(-this.options.pointerSize,"px"),o.style.top="".concat(t.getBoundingClientRect().height/2-this.options.pointerSize/2,"px"),n.style.left="".concat(e.getBoundingClientRect().width,"px"),n.style.top="".concat(e.getBoundingClientRect().height/2-this.options.pointerSize/2,"px");break;case p.verticalLeftTop:case p.verticalRightTop:o.position="bottom",n.position="top",o.style.left="".concat(t.getBoundingClientRect().width/2-this.options.pointerSize/2,"px"),o.style.top="".concat(t.getBoundingClientRect().height,"px"),n.style.left="".concat(e.getBoundingClientRect().width/2-this.options.pointerSize/2,"px"),n.style.top="".concat(-this.options.pointerSize,"px");break;case p.verticalLeftBottom:case p.verticalRightBottom:o.position="top",n.position="bottom",o.style.left="".concat(t.getBoundingClientRect().width/2-this.options.pointerSize/2,"px"),o.style.top="-".concat(this.options.pointerSize,"px"),n.style.left="".concat(e.getBoundingClientRect().width/2-this.options.pointerSize/2,"px"),n.style.top="".concat(e.getBoundingClientRect().height,"px")}return t.appendChild(o),e.appendChild(n),{start:o,end:n}}},{key:"getTotalOffset",value:function(t){return{offsetLeft:t.offsetLeft+t.offsetParent.offsetLeft,offsetTop:t.offsetTop+t.offsetParent.offsetTop}}},{key:"createSvgArea",value:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.innerHTML='\n    <defs>\n      <marker id="markerEndArrow" viewBox="0 0 30 30" refX="9" refY="3"  markerUnits="strokeWidth" markerWidth="30" markerHeight="30" orient="auto">\n        <path style="fill:'.concat(this.options.color,';opacity:1" d="M0,0 0,6 9,3z" />\n      </marker>\n    </defs>'),t.style.position="absolute",t.style.zIndex="-999",t.style.overflow="visible";var e=this.getTotalOffset(this.startPointer),o=e.offsetLeft,n=e.offsetTop,i=this.getTotalOffset(this.endPointer),r=i.offsetLeft,s=i.offsetTop;switch(this.startPosition){case p.horizontalLeftTop:case p.verticalLeftTop:t.style.left="".concat(o,"px"),t.style.top="".concat(n,"px");break;case p.horizontalRightTop:case p.verticalRightTop:t.style.left="".concat(r,"px"),t.style.top="".concat(n,"px");break;case p.horizontalLeftBottom:case p.verticalLeftBottom:t.style.left="".concat(o,"px"),t.style.top="".concat(s,"px");break;case p.horizontalRightBottom:case p.verticalRightBottom:t.style.left="".concat(r,"px"),t.style.top="".concat(s,"px")}var a=Math.abs(o-r)+this.options.pointerSize,c=Math.abs(n-s)+this.options.pointerSize;t.setAttribute("width","".concat(a,"px")),t.setAttribute("height","".concat(c,"px"));var l=t.width.baseVal.valueInSpecifiedUnits,h=t.height.baseVal.valueInSpecifiedUnits;return this.svgParameters={height:h,width:l,leftTop:[this.options.pointerSize/2,this.options.pointerSize/2],leftBottom:[this.options.pointerSize/2,h-this.options.pointerSize/2],rightTop:[l-this.options.pointerSize/2,this.options.pointerSize/2],rightBottom:[l-this.options.pointerSize/2,h-this.options.pointerSize/2]},t}},{key:"drawEndArrow",value:function(){console.log("base draw end point")}},{key:"drawPath",value:function(){var t,e;switch(this.startPosition){case p.verticalLeftTop:case p.horizontalLeftTop:t=this.svgParameters.leftTop,e=this.svgParameters.rightBottom;break;case p.verticalLeftBottom:case p.horizontalLeftBottom:t=this.svgParameters.leftBottom,e=this.svgParameters.rightTop;break;case p.verticalRightTop:case p.horizontalRightTop:t=this.svgParameters.rightTop,e=this.svgParameters.leftBottom;break;case p.verticalRightBottom:case p.horizontalRightBottom:t=this.svgParameters.rightBottom,e=this.svgParameters.leftTop}var o=h(this.options);!function(t,e,o){t.setAttributeNS(null,"points","".concat(e.toString()," ").concat(o.toString()))}(o,t,e),o.style.markerEnd="url(#markerEndArrow)",this.svgElement.appendChild(o)}}]),r}(),m=function(){function o(t,e){T(this,o),this.isDragging=!1,this.isCreatingNewConnector=!1,this.elem=t,this.dragOptions=e||{type:"straight"},this.makeItDraggable(),this.elemStartCoordinate={xPos:f(getComputedStyle(this.elem).left),yPos:f(getComputedStyle(this.elem).top)}}return e(o,[{key:"makeItDraggable",value:function(){var n=this;this.elem.style.position="absolute",this.elem.onmousedown=function(t){n.startCoordinate={xPos:t.clientX,yPos:t.clientY},n.isDragging=!0,document.onmousemove=function(t){if(n.isDragging){var e=t.clientX-n.startCoordinate.xPos,o=t.clientY-n.startCoordinate.yPos;n.elem.style.left=u(n.elemStartCoordinate.xPos+e),n.elem.style.top=u(n.elemStartCoordinate.yPos+o),"function"==typeof n.dragOptions.onDragging&&n.dragOptions.onDragging()}},document.onmouseup=function(){n.isDragging=!1,n.startCoordinate=void 0,n.elemStartCoordinate={xPos:f(getComputedStyle(n.elem).left),yPos:f(getComputedStyle(n.elem).top)},document.onmousemove=function(){}}}}}]),o}(),v=function(){function i(t,e,o,n){return T(this,i),c(this,a(i).call(this,t,e,o,n))}return r(i,d),e(i,[{key:"drawEndArrow",value:function(){function t(t,e){h.setAttributeNS(null,"d","\n          M".concat(t[0]," ").concat(t[1],"\n          L").concat(t[0]+e*l*Math.sin(o),"\n           ").concat(t[1]-e*l*Math.cos(o),"\n          L").concat(t[0]," ").concat(t[1]-e*l*.6,"\n          L").concat(t[0]-e*l*Math.sin(o),"\n           ").concat(t[1]-e*l*Math.cos(o),"\n          Z\n        "))}function e(t,e){h.setAttributeNS(null,"d","\n          M".concat(t[0]," ").concat(t[1],"\n          L").concat(t[0]-e*l*Math.cos(o)," ").concat(t[1]+e*l*Math.sin(o),"\n          L").concat(t[0]-e*l*.6," ").concat(t[1],"\n          L").concat(t[0]-e*l*Math.cos(o)," ").concat(t[1]-e*l*Math.sin(o),"\n          Z\n        "))}var o=.125*Math.PI,n=this.svgParameters,i=n.leftTop,r=n.leftBottom,s=n.rightTop,a=n.rightBottom,c=this.options,l=c.arrowSize,h=function(t,e){var o=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.keys(e).forEach(function(t){o.setAttributeNS(null,t,e[t])}),o}("path",{fill:c.color});switch(this.startPosition){case p.verticalLeftTop:t(a,1);break;case p.horizontalLeftTop:e(a,1);break;case p.verticalRightTop:t(r,1);break;case p.horizontalRightTop:e(r,-1);break;case p.verticalLeftBottom:t(s,-1);break;case p.horizontalLeftBottom:e(s,1);break;case p.verticalRightBottom:t(i,-1);break;case p.horizontalRightBottom:e(i,-1)}this.svgElement.appendChild(h)}},{key:"drawPath",value:function(){var t,e,o,n,i=this.svgElement.width.baseVal.valueInSpecifiedUnits,r=this.svgElement.height.baseVal.valueInSpecifiedUnits;switch(this.startPosition){case p.verticalLeftTop:t=this.svgParameters.leftTop,e=[this.options.pointerSize/2,r/2],o=[i-this.options.pointerSize/2,r/2],n=this.svgParameters.rightBottom;break;case p.horizontalLeftTop:t=this.svgParameters.leftTop,e=[i/2,this.options.pointerSize/2],o=[i/2,r-this.options.pointerSize/2],n=this.svgParameters.rightBottom;break;case p.verticalRightTop:t=this.svgParameters.rightTop,e=[i-this.options.pointerSize/2,r/2],o=[this.options.pointerSize/2,r/2],n=this.svgParameters.leftBottom;break;case p.horizontalRightTop:t=this.svgParameters.rightTop,e=[i/2,this.options.pointerSize/2],o=[i/2,r-this.options.pointerSize/2],n=this.svgParameters.leftBottom;break;case p.verticalLeftBottom:t=this.svgParameters.leftBottom,e=[this.options.pointerSize/2,r/2],o=[i-this.options.pointerSize/2,r/2],n=this.svgParameters.rightTop;break;case p.horizontalLeftBottom:t=this.svgParameters.leftBottom,e=[i/2,r-this.options.pointerSize/2],o=[i/2,this.options.pointerSize/2],n=this.svgParameters.rightTop;break;case p.verticalRightBottom:t=this.svgParameters.rightBottom,e=[i-this.options.pointerSize/2,r/2],o=[this.options.pointerSize/2,r/2],n=this.svgParameters.leftTop;break;case p.horizontalRightBottom:t=this.svgParameters.rightBottom,e=[i/2,r-this.options.pointerSize/2],o=[i/2,this.options.pointerSize/2],n=this.svgParameters.leftTop}var s=h(this.options);!function(t,e,o,n,i){t.setAttributeNS(null,"points","".concat(e.toString()," ").concat(o.toString()," ").concat(n.toString()," ").concat(i.toString()))}(s,t,e,o,n),this.svgElement.appendChild(s)}}]),i}(),y={undefined:d,straight:d,stateMachine:v},L=function(){function s(t,e,o,n){var i,r=n.onCreatingLine;return T(this,s),(i=c(this,a(s).call(this,e,o))).nativeElement=e,i.playground=t,i.onCreatingLine=r,g(e,"".concat(l,"-element")),i.createAnchor(),i}return r(s,m),e(s,[{key:"createAnchor",value:function(){var i=this,t=document.createElement("div");t.classList.add("".concat(l,"-anchor")),t.style.width="10px",t.style.height="10px",t.style.backgroundColor="red",t.style.position="absolute",t.style.left="15px",t.style.top="15px",t.onmousedown=function(t){t.stopPropagation(),i.isCreatingNewConnector=!0;var e=t.pageX-i.playground.offsetLeft,o=t.pageY-i.playground.offsetTop;i.helperPointer=document.createElement("div"),i.helperPointer.style.width="0px",i.helperPointer.style.height="0px",i.helperPointer.style.backgroundColor="blue",i.helperPointer.style.position="absolute",i.helperPointer.style.left="".concat(e,"px"),i.helperPointer.style.top="".concat(o,"px"),i.playground.appendChild(i.helperPointer);var n=new y[i.dragOptions.type](i.playground,i.elem,i.helperPointer,i.dragOptions);document.onmousemove=function(t){i.isCreatingNewConnector&&(i.helperPointer.style.left="".concat(t.pageX-i.playground.offsetLeft,"px"),i.helperPointer.style.top="".concat(t.pageY-i.playground.offsetTop,"px"),n&&n.renderLine())},document.onmouseup=function(t){i.isCreatingNewConnector=!1;var e=document.elementsFromPoint(t.clientX,t.clientY).filter(function(t){return t.classList.contains("cnt-element")});n.dispose(),0<e.length&&i.onCreatingLine(e[0]),i.helperPointer&&(i.playground.removeChild(i.helperPointer),i.helperPointer=void 0)}},this.elem.appendChild(t)}}]),s}(),k={undefined:d,straight:d,stateMachine:v},b=function(){function C(t){var o=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{type:"straight"};T(this,C),this.connectableElements=[],this.connections=[],this.elementConnectionsMap={},this.playground=t,this.options=i;var r=!0,s=!1,a=void 0;try{for(var c,l=e[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var h=c.value;this.elementConnectionsMap[h.id]=[]}}catch(t){s=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(s)throw a}}var p=!0,f=!1,u=void 0;try{for(var g,d=n[Symbol.iterator]();!(p=(g=d.next()).done);p=!0){var m=g.value,v=new k[i.type](t,m.start,m.end,i);this.elementConnectionsMap[m.start.id].push(v),this.elementConnectionsMap[m.end.id].push(v),this.connections.push(v)}}catch(t){f=!0,u=t}finally{try{p||null==d.return||d.return()}finally{if(f)throw u}}var y=!0,b=!1,P=void 0;try{for(var S,w=function(){var e=S.value;o.connectableElements.push(new L(t,e,B({},i,{onDragging:function(){o.elementConnectionsMap[e.id].forEach(function(t){return t.renderLine()})}}),{onCreatingLine:function(t){o.addConnection({start:e,end:t})}}))},z=e[Symbol.iterator]();!(y=(S=z.next()).done);y=!0)w()}catch(t){b=!0,P=t}finally{try{y||null==z.return||z.return()}finally{if(b)throw P}}}return e(C,[{key:"addElement",value:function(e){var o=this;this.elementConnectionsMap[e.id]=[],this.playground.appendChild(e),this.connectableElements.push(new L(this.playground,e,B({},this.options,{onDragging:function(){o.elementConnectionsMap[e.id].forEach(function(t){return t.renderLine()})}}),{onCreatingLine:function(t){o.addConnection({start:e,end:t})}}))}},{key:"addConnection",value:function(t){var e=new k[this.options.type](this.playground,t.start,t.end,this.options);this.elementConnectionsMap[t.start.id].push(e),this.elementConnectionsMap[t.end.id].push(e),this.connections.push(e)}}]),C}();t.EasyConnection=b,t.ConnectorBase=d,t.ConnectorStateMachine=v,t.Draggable=m,t.Connectable=L,Object.defineProperty(t,"__esModule",{value:!0})});
